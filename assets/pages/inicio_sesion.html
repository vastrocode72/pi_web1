<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" media="all">

  <link rel="icon" type="image/png" href="../imagenes/logo.png">
  <title>Inicio de Sesión</title>
</head>

<body class="fondo">
  <!-- Header -->
  <header class="header">
    <div>
      <div class="barra-superior">
        <a href="../pages/inicio_sesion.html" class="login-link">Iniciar sesión</a>
        <a href="../pages/registro.html" class="nav-button register-button">Regístrate</a>
      </div>

      <div class="logo">
        <a href="../../index.html">
          <img src="../imagenes/logo.png" alt="logo" />
        </a>
      </div>
    </div>

    <h1>Sistema de Gestión de Becas</h1>

    <nav>
      <ul>
        <li><a href="../../index.html">Inicio</a></li>
        <li><a href="../pages/equipo.html">Equipo</a></li>
        <li><a href="../pages/comoaplicar.html">Como aplicar</a></li>
        <li><a href="../pages/cronograma.html">Cronograma</a></li>
      </ul>
    </nav>
  </header>

  <!-- Formulario -->
  <div>
    <div class="contenedor">
      <div class="form-1">
        <h1 id="title">INICIAR SESION</h1>
        <form id="Login">
          <div class="form-3">
            <i class="fa-solid fa-user" style="color: #172A3A ;"></i>
            <input type="number" id="cedula" placeholder="Documento de identidad">
          </div>
          <div class="form-3">
            <i class="fa-solid fa-lock" style="color: #172A3A;"></i>
            <input type="password" name="password" id="contrasena" placeholder="Contraseña">
          </div><br><br>
          <div class="btn-field">
            <button type="button" class="button2" id="sigIn">Ingresar</button><br><br>
            <p id="mensaje"></p>
            <div class="registro">
              <nav>
                <button type="button" class="button2" id="sigUp"><a href="registro.html">Registrarse</a></button>
              </nav>


              <script>
                document.getElementById('sigIn').addEventListener('click', function () {


                  const cedula = document.getElementById('cedula').value.trim();
                  const contrasena = document.getElementById('contrasena').value.trim();
                  const mensaje = document.getElementById('mensaje');

                  if (cedula === "" || contrasena === "") {
                    mensaje.textContent = "Todos los campos son obligatorios.";
                    mensaje.style.color = "black";
                    return;
                  }

                  // URL con filtro por cédula
                  const url = `https://68f27b1eb36f9750deecc6df.mockapi.io/IniciodeSesion?cedula=${encodeURIComponent(cedula)}`;

                  fetch(url)
                    .then(response => {
                      if (!response.ok) throw new Error("No se pudo conectar con el servidor.");
                      return response.json();
                    })
                    .then(data => {
                      if (data.length === 0) {
                        // No se encontró usuario
                        mensaje.textContent = "Usuario no registrado. Debe registrarse primero.";
                        mensaje.style.color = "black";
                      } else {
                        // Usuario encontrado, verificar contraseña
                        const usuario = data[0];
                        if (usuario.contrasena === contrasena) {
                          mensaje.textContent = "Inicio de sesión exitoso.";
                          mensaje.style.color = "green";

                          localStorage.setItem("usuarioActivo", JSON.stringify(usuario)); //guarda el usuario activo

                          // Redirige al perfil después de 1 segundo
                          setTimeout(() => {
                            window.location.href = "miperfil.html"; // ajusta la ruta si está en otra carpeta
                          }, 1000);
                          // Aquí puedes redirigir al usuario o guardar sesión
                        } else {
                          mensaje.textContent = "Contraseña incorrecta.";
                          mensaje.style.color = "red";
                        }
                      }
                    })
                    .catch(error => {
                      console.error("Error:", error);
                      mensaje.textContent = "Error al verificar los datos. Intenta más tarde.";
                      mensaje.style.color = "red";
                    });
                });
              </script>
</body>
</html>